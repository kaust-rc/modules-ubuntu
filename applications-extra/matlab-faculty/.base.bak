#%Module 1.0 -*- tcl -*-
#
#  Module for use with 'environment-modules' package:
# 

set name [lrange [split [ module-info name ] / ] 0 0 ]
set dir_name MATLAB-faculty
set version [ file tail [ module-info name ] ]
set loading [module-info mode load]
set unloading [module-info mode remove]

conflict matlab
conflict matlab-classroom
conflict matlab-faculty

if { [info exists env(MATLAB_ROOT)] } {
    set app_dir $env(MATLAB_ROOT)
} else {
    if { [info exists env(KAUST_APPS_ROOT)] } {
	set app_dir $env(KAUST_APPS_ROOT)/$dir_name/$version.app
    } else {
	set app_dir /opt/share/$dir_name/$version.app
    }
}

prepend-path PATH $app_dir/bin

if { $loading } {
    puts stderr "Loading module $name version $version"
}
if { $unloading } {
    puts stderr "Unloading module $name version $version"
}


set module_extra_dir "[file dirname $ModulesCurrentModulefile]/../../applications-extra"
set desc_file [join [read [ open "$module_extra_dir/$name/.desc" ] ] ]

setenv KAUST_MATLAB_ROOT $app_dir

module-whatis   "$desc_file"

